import{t as N}from"./useToast-DGTAcHwR.min.js";import{a as v,t as y}from"./settings-EuhnKFOO.js";var w=e=>Number.isFinite(e)?e:0;function C(e){return{days:Math.trunc(e/864e5),hours:Math.trunc(e/36e5%24),minutes:Math.trunc(e/6e4%60),seconds:Math.trunc(e/1e3%60),milliseconds:Math.trunc(e%1e3),microseconds:Math.trunc(w(e*1e3)%1e3),nanoseconds:Math.trunc(w(e*1e6)%1e3)}}function D(e){return{days:e/86400000n,hours:e/3600000n%24n,minutes:e/60000n%60n,seconds:e/1000n%60n,milliseconds:e%1000n,microseconds:0n,nanoseconds:0n}}function _(e){switch(typeof e){case"number":if(Number.isFinite(e))return C(e);break;case"bigint":return D(e)}throw TypeError("Expected a finite number or bigint")}var S=e=>e===0||e===0n,k=(e,n)=>n===1||n===1n?e:`${e}s`,x=1e-7,F=24n*60n*60n*1000n;function G(e,n){let l=typeof e=="bigint";if(!l&&!Number.isFinite(e))throw TypeError("Expected a finite number or bigint");n={...n};let u=e<0?"-":"";e=e<0?-e:e,n.colonNotation&&(n.compact=!1,n.formatSubMilliseconds=!1,n.separateMilliseconds=!1,n.verbose=!1),n.compact&&(n.unitCount=1,n.secondsDecimalDigits=0,n.millisecondsDecimalDigits=0);let r=[],p=(c,t)=>{let a=Math.floor(c*10**t+x);return(Math.round(a)/10**t).toFixed(t)},i=(c,t,a,o)=>{if(!((r.length===0||!n.colonNotation)&&S(c)&&!(n.colonNotation&&a==="m"))){if(o??(o=String(c)),n.colonNotation){let d=o.includes(".")?o.split(".")[0].length:o.length,f=r.length>0?2:1;o="0".repeat(Math.max(0,f-d))+o}else o+=n.verbose?" "+k(t,c):a;r.push(o)}},s=_(e),h=BigInt(s.days);if(n.hideYearAndDays?i(BigInt(h)*24n+BigInt(s.hours),"hour","h"):(n.hideYear?i(h,"day","d"):(i(h/365n,"year","y"),i(h%365n,"day","d")),i(Number(s.hours),"hour","h")),i(Number(s.minutes),"minute","m"),!n.hideSeconds)if(n.separateMilliseconds||n.formatSubMilliseconds||!n.colonNotation&&e<1e3&&!n.subSecondsAsDecimals){let c=Number(s.seconds),t=Number(s.milliseconds),a=Number(s.microseconds),o=Number(s.nanoseconds);if(i(c,"second","s"),n.formatSubMilliseconds)i(t,"millisecond","ms"),i(a,"microsecond","\xB5s"),i(o,"nanosecond","ns");else{let d=t+a/1e3+o/1e6,f=typeof n.millisecondsDecimalDigits=="number"?n.millisecondsDecimalDigits:0,g=f?d.toFixed(f):d>=1?Math.round(d):Math.ceil(d);i(Number.parseFloat(g),"millisecond","ms",g)}}else{let c=(l?Number(e%F):e)/1e3%60,t=typeof n.secondsDecimalDigits=="number"?n.secondsDecimalDigits:1,a=p(c,t),o=n.keepDecimalsOnWholeSeconds?a:a.replace(/\.0+$/,"");i(Number.parseFloat(o),"second","s",o)}if(r.length===0)return u+"0"+(n.verbose?" milliseconds":"ms");let M=n.colonNotation?":":" ";return typeof n.unitCount=="number"&&(r=r.slice(0,Math.max(n.unitCount,1))),u+r.join(M)}var b=new BroadcastChannel("windpress"),m=N();async function E(e){let n=y(),l=v();l.add("settings.performance.cached_css.generate");let u={title:wp.i18n.__("Generating cache...","windpress"),description:wp.i18n.__("Please wait while we generate the CSS cache.","windpress"),duration:0,icon:"lucide:loader-circle",close:!1,color:"neutral",ui:{icon:"animate-spin"}};m.toasts.value.find(i=>i.id==="worker.doGenerateCache")?m.update("worker.doGenerateCache",{...u}):m.add({id:"worker.doGenerateCache",...u});let r=performance.now(),p=r;b.postMessage({task:"generate-cache",source:"windpress/dashboard",target:"windpress/compiler",data:{tailwindcss_version:Number(n.virtualOptions("general.tailwindcss.version",4).value)}}),b.addEventListener("message",i=>{let s=i.data;s.source==="windpress/compiler"&&s.target==="windpress/dashboard"&&s.task==="generate-cache.response"&&(l.remove("settings.performance.cached_css.generate"),p=performance.now(),s.data.status==="success"?(m.update("worker.doGenerateCache",{title:wp.i18n.__("Cache generated","windpress"),description:wp.i18n.sprintf(wp.i18n.__("Cache generated in %s.","windpress"),G(p-r)),icon:"lucide:codesandbox",color:"success",duration:void 0,close:!0,ui:{icon:void 0}}),e==null||e(!0)):s.data.status==="error"&&(m.update("worker.doGenerateCache",{title:wp.i18n.__("Generate Cache Error","windpress"),description:wp.i18n.__("An error occurred while generating the CSS cache. Check the Browser's Console for more information","windpress"),icon:"lucide:codesandbox",color:"error",duration:void 0,close:!0,ui:{icon:void 0}}),e==null||e(!1)))})}export{E as t};
