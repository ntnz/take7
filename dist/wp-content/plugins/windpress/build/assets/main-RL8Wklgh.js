import"./dist-gE_XXzPp.min.js";import{Gt as F}from"./runtime-core.esm-bundler-DRZAYnQ2.min.js";import"./vue.runtime.esm-bundler-BlWQ9Hv9.min.js";import"./core-8AzxaLAT.min.js";import{t as K}from"./index.browser-DQZXIZaU.min.js";import{i as R,r as A,t as h}from"./isObject-DkMBgCmn.min.js";import{l as G,o as M,u as _}from"./_toKey-lf-76zFF.min.js";import{_ as C,a as I,c as O,d as U,h as j,m as B,n as J,o as X,s as Q,t as Y,v as Z,y as tt}from"./_initCloneObject-7WDIrBbB.min.js";import{a as P,i as et,r as rt}from"./set-D10waSiW.min.js";import"./get-CMyps7rf.min.js";import"./virtualRef-CZBazqxr.js";import{t as d}from"./logger-B3j_KY2M.js";import{a as w,n as b}from"./constant-BwtmMKdP.js";function at(t){return t}var H=at;function it(t,r,e){switch(e.length){case 0:return t.call(r);case 1:return t.call(r,e[0]);case 2:return t.call(r,e[0],e[1]);case 3:return t.call(r,e[0],e[1],e[2])}return t.apply(r,e)}var nt=it,st=800,ot=16,lt=Date.now;function ut(t){var r=0,e=0;return function(){var a=lt(),n=ot-(a-e);if(e=a,n>0){if(++r>=st)return arguments[0]}else r=0;return t.apply(void 0,arguments)}}var ct=ut;function dt(t){return function(){return t}}var mt=dt,pt=ct(P?function(t,r){return P(t,"toString",{configurable:!0,enumerable:!1,value:mt(r),writable:!0})}:H),S=Math.max;function ft(t,r,e){return r=S(r===void 0?t.length-1:r,0),function(){for(var a=arguments,n=-1,i=S(a.length-r,0),s=Array(i);++n<i;)s[n]=a[r+n];n=-1;for(var o=Array(r+1);++n<r;)o[n]=a[n];return o[r]=e(s),nt(t,this,o)}}var bt=ft;function gt(t,r){return pt(bt(t,r,H),t+"")}var vt=gt;function ht(t,r,e){if(!h(e))return!1;var a=typeof r;return(a=="number"?C(e)&&et(r,e.length):a=="string"&&r in e)?M(e[r],t):!1}var wt=ht;function yt(t){return vt(function(r,e){var a=-1,n=e.length,i=n>1?e[n-1]:void 0,s=n>2?e[2]:void 0;for(i=t.length>3&&typeof i=="function"?(n--,i):void 0,s&&wt(e[0],e[1],s)&&(i=n<3?void 0:i,n=1),r=Object(r);++a<n;){var o=e[a];o&&t(r,o,a,i)}return r})}var kt=yt,xt="[object Object]",Tt=Function.prototype,Lt=Object.prototype,q=Tt.toString,Nt=Lt.hasOwnProperty,Et=q.call(Object);function At(t){if(!A(t)||R(t)!=xt)return!1;var r=Q(t);if(r===null)return!0;var e=Nt.call(r,"constructor")&&r.constructor;return typeof e=="function"&&e instanceof e&&q.call(e)==Et}var Mt=At;function _t(t){return function(r,e,a){for(var n=-1,i=Object(r),s=a(r),o=s.length;o--;){var l=s[t?o:++n];if(e(i[l],l,i)===!1)break}return r}}var Ct=_t();function Ot(t,r,e){(e!==void 0&&!M(t[r],e)||e===void 0&&!(r in t))&&rt(t,r,e)}var y=Ot;function jt(t){return A(t)&&C(t)}var Pt=jt;function Ht(t,r){if(!(r==="constructor"&&typeof t[r]=="function")&&r!="__proto__")return t[r]}var k=Ht;function St(t){return Z(t,O(t))}var qt=St;function Dt(t,r,e,a,n,i,s){var o=k(t,e),l=k(r,e),N=s.get(l);if(N){y(t,e,N);return}var u=i?i(o,l,e+"",t,r,s):void 0,f=u===void 0;if(f){var g=_(l),v=!g&&B(l),E=!g&&!v&&U(l);u=l,g||v||E?_(o)?u=o:Pt(o)?u=tt(o):v?(f=!1,u=I(l,!0)):E?(f=!1,u=J(l,!0)):u=[]:Mt(l)||j(l)?(u=o,j(o)?u=qt(o):(!h(o)||G(o))&&(u=Y(l))):f=!1}f&&(s.set(l,u),n(u,l,a,i,s),s.delete(l)),y(t,e,u)}var $t=Dt;function D(t,r,e,a,n){t!==r&&Ct(r,function(i,s){if(n||(n=new X),h(i))$t(t,r,s,e,D,a,n);else{var o=a?a(k(t,s),i,s+"",t,r,n):void 0;o===void 0&&(o=i),y(t,s,o)}},O)}var Vt=D,c=kt(function(t,r,e){Vt(t,r,e)}),$=()=>K("1234567890abcdefghijklmnopqrstuvwxyz",6)();function x(){let t=$();for(;t.match(/^\d/);)t=$();return`windpress${t}`}function Wt(t){let r=[];return t.childNodes.forEach(e=>{let a=V(e);a.transformedNode&&r.push(a.transformedNode)}),W(r,0)}function zt(t){let r=t.tagName.toLowerCase(),e={id:x(),name:"div",settings:{tag:r},children:[]},a=[],n=["id","class","href","src"];if(Object.keys(t.attributes).forEach(i=>{let s=t.attributes[i].name;n.includes(s)?(s==="class"&&t.attributes[i].value.trim()!==""&&c(e.settings,{_cssClasses:t.attributes[i].value}),s==="id"&&t.id.trim()!==""&&c(e.settings,{_cssId:t.id}),s==="href"&&t.tagName.toLowerCase()==="a"&&c(e.settings,{link:{url:t.getAttribute("href")}})):a.push({id:x(),name:s,value:t.attributes[i].value})}),c(e.settings,{_attributes:a}),r==="svg")return e.name="svg",c(e.settings,{source:"code",code:t.outerHTML}),e.settings._attributes=[],e;if(r==="img"){let i=t.getAttribute("src");return e.name="image",c(e.settings,{image:{external:!0,url:i||"",full:i||"",filename:i.split("/").pop()||""},altText:t.getAttribute("alt")||""}),delete e.settings.tag,e}if(r.match(/h[1-6]/)&&(e.name="heading",c(e.settings,{text:t.innerText,tag:r})),r==="video"||r==="iframe"&&(t.getAttribute("src").includes("youtube.com")||t.getAttribute("src").includes("vimeo.com")))return e.name="video",c(e.settings,{source:"url",url:r==="video"?t.getAttribute("src"):t.getAttribute("src").split("?")[0]}),delete e.settings.tag,e;if(r==="a"){if(c(e.settings,{link:{type:"external",url:t.getAttribute("href")||"",newTab:t.getAttribute("target")==="_blank",ariaLabel:t.getAttribute("aria-label")||"",title:t.getAttribute("title")||"",rel:t.getAttribute("rel")||""}}),t.children.length===0)return e.name="text-basic",c(e.settings,{text:t.innerText}),e;c(e.settings,{text:t.innerText})}return t.childNodes.forEach(i=>{let{transformedNode:s,brxNode:o=null}=V(i,t,e);s&&e.children.push(s),o&&(e=o)}),e}function V(t,r=null,e=null){return t.nodeType===Node.ELEMENT_NODE?{transformedNode:zt(t)}:t.nodeType===Node.TEXT_NODE&&t.nodeValue.trim()!==""?r&&e&&r.childNodes.length===1&&(r.tagName.toLowerCase()==="p"||r.tagName.toLowerCase()==="span"||r.tagName.toLowerCase()==="div")?(e.name="text-basic",c(e.settings,{text:t.nodeValue}),{transformedNode:null,brxNode:e}):{transformedNode:{id:x(),name:"text-basic",settings:{tag:"span",text:t.nodeValue},children:[]}}:{transformedNode:null}}function W(t,r){let e=[];return t.forEach(a=>{a.parent=r,a._children=a.children.map(n=>n.id),e.push(a),e.push(...W(a.children,a.id)),a.children=a._children,delete a._children}),e}async function Ft(){if(!navigator.permissions)return d("Clipboard permissions not supported",{module:"html2bricks",type:"error"}),!1;let t="",r=await navigator.permissions.query({name:"clipboard-read",allowWithoutGesture:!1});if(r.state==="prompt"&&(d("Requesting clipboard-read permission",{module:"html2bricks"}),t=await navigator.clipboard.readText(),r.state!=="granted"))return d("Clipboard-read permission denied",{module:"html2bricks",type:"error"}),!1;t=await navigator.clipboard.readText();let e=await navigator.permissions.query({name:"clipboard-write"});return e.state==="prompt"&&(d("Requesting clipboard-write permission",{module:"html2bricks"}),await navigator.clipboard.writeText(t),e.state!=="granted")?(d("Clipboard-write permission denied",{module:"html2bricks",type:"error"}),!1):!0}async function T(){if(!await Ft()){b.$_showMessage("[WindPress] Clipboard access not available");return}let t=(await navigator.clipboard.readText()).trim();if(!t||t.charAt(0)!=="<"){d("Pasted content is not HTML",{module:"html2bricks",type:"error"}),b.$_showMessage("[WindPress] Pasted content is not HTML");return}let r=new DOMParser().parseFromString(t,"text/html").body,e={content:Wt(r),source:"bricksCopiedElements",sourceUrl:window.bricksData.siteUrl,version:window.bricksData.version,globalClasses:[],globalElements:[]};await navigator.clipboard.writeText(JSON.stringify(e,null)),b.$_pasteElements(),b.$_showMessage("[WindPress] HTML pasted"),await navigator.clipboard.writeText(t)}document.addEventListener("keydown",t=>{w("module.html2bricks.copy-paste",!0).value&&(t.target.id==="bricks-toolbar"||t.target.id==="bricks-panel"||!(t.ctrlKey||t.metaKey)||!t.shiftKey||t.key.toLowerCase()!=="v"||T())});var L=document.querySelector("#bricks-builder-context-menu li:nth-child(2)"),m=document.createElement("li");m.id="windpressbricks-html2bricks-context-menu",m.classList.add("sep"),m.innerHTML='<span class="label">Paste HTML</span><span class="shortcut">CTRL + SHIFT + V</span>',m.addEventListener("click",T);var Kt=document.querySelector('#bricks-panel-header>ul.actions>li[data-balloon="Paste (All)"]'),p=document.createElement("li");p.dataset.balloon="Paste HTML",p.dataset.balloonPos="bottom-right",p.innerHTML=`
    <span class="bricks-svg-wrapper">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-html5" fill="none" stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M20 4l-2 14.5l-6 2l-6 -2l-2 -14.5z" /><path d="M15.5 8h-7l.5 4h6l-.5 3.5l-2.5 .75l-2.5 -.75l-.1 -.5" /></svg>
    </span>
`,p.addEventListener("click",T);var z=()=>{L.classList.remove("sep"),L.insertAdjacentElement("afterend",m),Kt.insertAdjacentElement("afterend",p)},Rt=()=>{L.classList.add("sep"),m.remove(),p.remove()};w("module.html2bricks.copy-paste",!0).value&&z(),F(()=>w("module.html2bricks.copy-paste",!0).value,t=>{t?z():Rt()}),d("Module loaded!",{module:"html2bricks"});
