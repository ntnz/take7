var g=new Map;function z(e){var t=g.get(e);t&&t.destroy()}function T(e){var t=g.get(e);t&&t.update()}var p=null;typeof window>"u"?((p=function(e){return e}).destroy=function(e){return e},p.update=function(e){return e}):((p=function(e,t){return e&&Array.prototype.forEach.call(e.length?e:[e],function(r){return(function(n){if(n&&n.nodeName&&n.nodeName==="TEXTAREA"&&!g.has(n)){var o,s=null,i=window.getComputedStyle(n),l=(o=n.value,function(){v({testForHeightReduction:o===""||!n.value.startsWith(o),restoreTextAlign:null}),o=n.value}),y=(function(d){n.removeEventListener("autosize:destroy",y),n.removeEventListener("autosize:update",h),n.removeEventListener("input",l),window.removeEventListener("resize",h),Object.keys(d).forEach(function(c){return n.style[c]=d[c]}),g.delete(n)}).bind(n,{height:n.style.height,resize:n.style.resize,textAlign:n.style.textAlign,overflowY:n.style.overflowY,overflowX:n.style.overflowX,wordWrap:n.style.wordWrap});n.addEventListener("autosize:destroy",y),n.addEventListener("autosize:update",h),n.addEventListener("input",l),window.addEventListener("resize",h),n.style.overflowX="hidden",n.style.wordWrap="break-word",g.set(n,{destroy:y,update:h}),h()}function v(d){var c,u,b=d.restoreTextAlign,m=b===void 0?null:b,E=d.testForHeightReduction,L=E===void 0||E,A=i.overflowY;if(n.scrollHeight!==0&&(i.resize==="vertical"?n.style.resize="none":i.resize==="both"&&(n.style.resize="horizontal"),L&&(c=(function(a){for(var k=[];a&&a.parentNode&&a.parentNode instanceof Element;)a.parentNode.scrollTop&&k.push([a.parentNode,a.parentNode.scrollTop]),a=a.parentNode;return function(){return k.forEach(function(R){var x=R[0],N=R[1];x.style.scrollBehavior="auto",x.scrollTop=N,x.style.scrollBehavior=null})}})(n),n.style.height=""),u=i.boxSizing==="content-box"?n.scrollHeight-(parseFloat(i.paddingTop)+parseFloat(i.paddingBottom)):n.scrollHeight+parseFloat(i.borderTopWidth)+parseFloat(i.borderBottomWidth),i.maxHeight!=="none"&&u>parseFloat(i.maxHeight)?(i.overflowY==="hidden"&&(n.style.overflow="scroll"),u=parseFloat(i.maxHeight)):i.overflowY!=="hidden"&&(n.style.overflow="hidden"),n.style.height=u+"px",m&&(n.style.textAlign=m),c&&c(),s!==u&&(n.dispatchEvent(new Event("autosize:resized",{bubbles:!0})),s=u),A!==i.overflow&&!m)){var w=i.textAlign;i.overflow==="hidden"&&(n.style.textAlign=w==="start"?"end":"start"),v({restoreTextAlign:w,testForHeightReduction:!0})}}function h(){v({testForHeightReduction:!0,restoreTextAlign:null})}})(r)}),e}).destroy=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],z),e},p.update=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],T),e});var F=p;function f(e,t){this.init(e,t)}f.instance=function(e,t){return new f(e,t)},f.prototype={ID:"hit",init:function(e,t){typeof e=="string"?this.el=document.querySelector(e):this.el=e,this.getType(t)==="custom"?(this.highlight=t,this.generate()):console.error("valid config object not provided")},getType:function(e){let t=typeof e;if(e){if(Array.isArray(e))return e.length===2&&typeof e[0]=="number"&&typeof e[1]=="number"?"range":"array";if(t==="object"){if(e instanceof RegExp)return"regexp";if(e.hasOwnProperty("highlight"))return"custom"}else if(t==="function"||t==="string")return t}else return"falsey";return"other"},generate:function(){this.el.classList.add(this.ID+"-input",this.ID+"-content"),this.el.addEventListener("input",this.handleInput.bind(this)),this.el.addEventListener("scroll",this.handleScroll.bind(this)),this.highlights=document.createElement("div"),this.highlights.classList.add(this.ID+"-highlights",this.ID+"-content"),this.backdrop=document.createElement("div"),this.backdrop.classList.add(this.ID+"-backdrop"),this.backdrop.append(this.highlights),this.container=document.createElement("div"),this.container.classList.add(this.ID+"-container"),this.el.parentNode.insertBefore(this.container,this.el.nextSibling),this.container.append(this.backdrop),this.container.append(this.el),this.container.addEventListener("scroll",this.blockContainerScroll.bind(this)),this.handleInput()},handleInput:function(){let e=this.el.value,t=this.getRanges(e,this.highlight),r=this.removeStaggeredRanges(t),n=this.getBoundaries(r);this.renderMarks(n)},getRanges:function(e,t){switch(this.getType(t)){case"array":return this.getArrayRanges(e,t);case"function":return this.getFunctionRanges(e,t);case"regexp":return this.getRegExpRanges(e,t);case"string":return this.getStringRanges(e,t);case"range":return this.getRangeRanges(e,t);case"custom":return this.getCustomRanges(e,t);default:if(t)console.error("unrecognized highlight type");else return[]}},getArrayRanges:function(e,t){let r=t.map(this.getRanges.bind(this,e));return Array.prototype.concat.apply([],r)},getFunctionRanges:function(e,t){return this.getRanges(e,t(e))},getRegExpRanges:function(e,t){let r=[],n;for(;n=t.exec(e),n!==null&&(r.push([n.index,n.index+n[0].length]),t.global););return r},getStringRanges:function(e,t){let r=[],n=e.toLowerCase(),o=t.toLowerCase(),s=0;for(;s=n.indexOf(o,s),s!==-1;)r.push([s,s+o.length]),s+=o.length;return r},getRangeRanges:function(e,t){return[t]},getCustomRanges:function(e,t){let r=this.getRanges(e,t.highlight);return t.className&&r.forEach(function(n){n.className?n.className=t.className+" "+n.className:n.className=t.className}),t.blank&&r.forEach(function(n){n.blank=t.blank}),r},removeStaggeredRanges:function(e){let t=[];return e.forEach(function(r){t.some(function(n){let o=r[0]>n[0]&&r[0]<n[1],s=r[1]>n[0]&&r[1]<n[1];return o!==s})||t.push(r)}),t},getBoundaries:function(e){let t=[];return e.forEach(function(r){t.push({type:"start",index:r[0],className:r.className,blank:r.blank}),t.push({type:"stop",index:r[1]})}),this.sortBoundaries(t),t},sortBoundaries:function(e){e.sort(function(t,r){return t.index===r.index?t.type==="stop"&&r.type==="start"?1:t.type==="start"&&r.type==="stop"?-1:0:r.index-t.index})},renderMarks:function(e){let t=this.el.value,r=t;e.forEach(function(n,o){let s;s=n.type==="start"?"{{hit-mark-start|"+o+"}}":"{{hit-mark-stop}}",t=t.slice(0,n.index)+s+t.slice(n.index)}),t=t.replace(/\n({{hit-mark-stop}})?$/,`
$1`),t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;"),t=t.replace(/{{hit-mark-start\|(\d+)}}/g,function(n,o){let s=e[+o].className;if(s){let i='<mark class="'+s+'"';if(s==="word"){let l=r.slice(e[+o].index,e[o-1].index);l=l.replace(/"/g,"&quot;"),i+=' data-word="'+l+'"'}return i+">"}else return"<mark>"}),t=t.replace(/{{hit-mark-stop}}/g,"</mark>"),t+='<mark class="placeholder"> \u26A1 </mark>',this.highlights.innerHTML=t,this.el.dispatchEvent(new CustomEvent("highlights-updated"))},handleScroll:function(){this.backdrop.scrollTop=this.el.scrollTop;let e=this.el.scrollLeft;e>0?this.backdrop.style.transform="translateX("+-e+"px)":this.backdrop.style.transform=""},blockContainerScroll:function(){this.container.scrollLeft=0},destroy:function(){this.container.parentElement.replaceChild(this.el,this.container),this.el.classList.remove(this.ID+"-content",this.ID+"-input")}};var I=f;export{F as n,I as t};
